# Kitting_Factory

## Build-TestEnvironment.bat の解説

このプロジェクトの `src` フォルダに含まれる `Build-TestEnvironment.bat` は、PowerShellスクリプト `Build-TestEnvironment.ps1` を呼び出すためのラッパーです。実際の処理はすべてPowerShellスクリプトに記述されています。

### スクリプトの目的

このスクリプトは、Hyper-V上に「MockServer」と「Test-PC」という2台の仮想マシンから成るテスト環境を自動で構築します。

### 主な処理の流れ

#### 1. 前提条件のチェック
スクリプトの実行に必須のファイル（各種ISOイメージ、設定ファイルなど）が `Source` フォルダなどに存在するかを確認します。

#### 2. 仮想ネットワークの構築
Hyper-Vに2種類の仮想スイッチを作成します。
- **vSwitch-Internet**: 外部ネットワーク（インターネット）に接続するためのスイッチ。
- **vSwitch-LGWAN**: 仮想マシン間を接続するためのプライベートなスイッチ。

#### 3. MockServerの構築（完全自動）
- **仮想マシンの作成**: Windows Server 2025をインストールするための仮想マシンを、TPMやセキュアブートを有効にして作成します。
- **OSの自動展開**: VHDX（仮想ハードディスク）ファイルに直接OSイメージを書き込む「オフラインイメージング」により、OSのインストールを高速かつ完全に自動化します。
- **初期設定の自動化**: OSの初回起動時のセットアップを自動化するための応答ファイル (`unattend.xml`) や、サーバー設定用のスクリプト (`Setup-MockServer.ps1` など) をVHDX内にコピーします。

#### 4. Test-PCの構築（半自動）
- **仮想マシンの作成**: Windows Client OSをインストールするための仮想マシンを、Windows 11の要件を満たすように設定して作成します。
- **手動インストールの要求**: こちらの仮想マシンではOSのインストールは自動化されません。スクリプト完了後、ユーザーが手動でOSをインストールする必要があります。

### 結論
このスクリプトは、**「MockServer」をOSインストール含めほぼ全自動で構築**し、**「Test-PC」はOSインストールを手動で行う前提で仮想マシンのみを自動作成**する、という2段階の自動化を実現するものです。