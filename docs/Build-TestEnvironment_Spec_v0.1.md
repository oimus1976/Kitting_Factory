---
title: Build-TestEnvironment 仕様書
version: v0.1
status: reboot-draft
created: 2026-01-22
scope: build
related_scripts:
  - scripts/Build-TestEnvironment.ps1
  - scripts/Verify-TestEnvironment.ps1
notes:
  - 本書は実装から逆算して設計を言語化するための仕様書である
  - 実装詳細はスクリプトを一次情報とする
---

# Build-TestEnvironment 仕様書（v0.1 / たたき）

## 0. 本書の位置づけとスコープ（改訂案）

### 0.1 本書の位置づけ

本書は、ゼロタッチ検証環境を構築するための
**設計上の前提条件・構成方針・判断基準を定義する正本仕様書**である。

本プロジェクトにおける構成・挙動・役割分担は、
**本書に記載された内容を基準として解釈・実装されるものとする。**

`Build-TestEnvironment.ps1` をはじめとする各スクリプトは、
本書に記載された仕様を実現するための **参照実装**であり、
仕様そのものを規定するものではない。

---

### 0.2 本書の目的

本書の目的は以下のとおりである。

- 検証環境構築における **設計判断を明文化する**
- 実行環境（ネットワーク・端末差異）による揺らぎを前提条件として定義する
- Build / Verify / 運用の責務境界を明確にする
- 将来的な実装変更時に、**「何を守るべきか」**を判断できる材料を残す

---

### 0.3 実装との関係

- 本書は **仕様の正本**である
- スクリプトは **仕様を満たすための実装例**である
- 実装が仕様に合わない場合、**実装を修正する**
- 仕様を変更する場合は、**本書を先に更新する**

この関係性は、
本プロジェクト全体において一貫して維持されるものとする。

本書と実装に乖離が生じた場合は、その乖離自体を設計判断の対象とし、いずれかを更新する。

---

### 0.4 本書のスコープ

本書が扱う内容は、以下に限定される。

- 検証環境全体の構成方針
- 仮想マシン・仮想スイッチの役割定義
- Build / Verify の責務分担
- ネットワーク設計に関する前提条件

---

### 0.5 本書が扱わない内容

以下の内容は、本書のスコープ外とする。

- `Setup-MockServer.ps1` 内部の詳細実装
- 個別OS設定の網羅的な手順
- 本番運用を前提としたセキュリティ・可用性設計
- 人的運用手順や組織ルール

これらは必要に応じて、
別ドキュメントまたは実装内コメントに委譲する。

---

## 1. 全体像（ゴールと非ゴール）

本章では、本プロジェクトが **何を達成しようとしているのか**、
また **意図的に達成しないことは何か**を明確にする。

ここで定義されたゴール／非ゴールは、
以降の設計判断・実装変更・Verify の合否判定における基準となる。

---

### 1.1 ゴール

本プロジェクトのゴールは、以下の状態を実現することである。

#### 1.1.1 再現可能な検証環境の構築

- 検証用 PC キッティング環境を、
  **同一手順・同一成果物で再現可能に構築できること**
- 実行者・実行端末・実行場所が変わっても、
  構築結果の構造が変わらないこと

再現性は「一度動いた」ことではなく、
**何度やっても同じ状態に戻せること**を指す。

---

#### 1.1.2 Build → Verify → Test の分離と明確化

- Build は「環境を作る」ことに責務を限定する
- Verify は「前提条件と状態を説明する」ことに専念する
- Test は「業務・キッティング検証」を行う

これらを混在させないことで、

- 不具合の切り分けが可能になる
- Verify の結果が判断材料として機能する
- 「どこが壊れているか」を説明できる

という状態を実現する。

---

#### 1.1.3 実行環境非依存の設計

- 外部ネットワーク（社内LAN / Wi-Fi / テザリング）に依存しない
- ホストPCのIPアドレス・セグメントに意味を持たせない
- 検証環境内部の通信経路を明示的に設計する

これにより、

- 環境差異による Verify 失敗を減らす
- 「なぜ繋がらないのか」を設計上説明できる
- 検証の前提条件を言語化できる

状態をゴールとする。

---

### 1.2 非ゴール

本プロジェクトでは、以下の内容を **意図的にゴールとしない**。

#### 1.2.1 本番環境の構築・再現

- 本番Active Directory環境の構築
- 本番ネットワーク構成の忠実な再現
- 本番データ・ユーザーを用いた検証

これらは検証目的・リスクが異なるため、本書の対象外とする。

---

#### 1.2.2 ネットワーク構成そのものの最適化

- IPアドレス設計の最適解追求
- ルーティング・冗長化の設計
- パフォーマンスチューニング

ネットワークは「成立していること」を重視し、
**最適であることは求めない**。

---

#### 1.2.3 セキュリティ要件の網羅的担保

- 本番相当のセキュリティポリシー適用
- 監査対応・ログ保全
- 権限分離の厳密化

本プロジェクトでは、
**検証を成立させるための最低限のセキュリティ**に留める。

---

## 第1章で確定した判断

- 「動けばよい」ではなく「説明できること」をゴールとする
- Verify は成功・失敗を **判定するための根拠**を提供する
- 外部要因に引きずられない構造を最優先とする

---

## 2. 前提条件・制約

本章では、本プロジェクトが成立するために **必ず満たされている必要がある前提条件**と、
設計上あらかじめ受け入れる **制約条件**を定義する。

これらの前提・制約は、
Verify において「満たされているかどうか」を説明・判断する基準となる。

---

### 2.1 実行環境前提

本プロジェクトは、以下の実行環境を前提とする。

- Windows をホストOSとすること
- Hyper-V 機能が有効であること
- 管理者権限でスクリプトを実行できること
- PowerShell 5.1 以上が利用可能であること

これらは Build / Verify のいずれにおいても共通の前提であり、
満たされていない場合、**以降の結果は評価対象外**とする。

Verify は、これらの前提条件が満たされているかどうかを
明示的に確認・表示する責務を持つ。

---

### 2.2 ネットワークに関する前提

本プロジェクトにおけるネットワーク設計は、
以下の前提条件を **必須条件**として扱う。

- 外部ネットワーク（社内LAN / Wi-Fi / テザリング）は実行環境ごとに異なる
- ホストOSに割り当てられるIPアドレスは固定されない
- 外部ネットワーク上のIPアドレスに設計上の意味を持たせない

これらは「回避すべき問題」ではなく、
**最初から受け入れる制約条件**である。

---

### 2.3 管理通信に関する前提

本プロジェクトでは、以下を前提とする。

- ホストと検証環境（MockServer）間の管理通信は
  **外部ネットワークを経由しない**
- 管理通信は、専用に設計された仮想ネットワーク上で完結する

具体的には、

- WinRM による接続
- Verify-TestEnvironment による疎通・状態確認

は、外部ネットワーク環境に依存しない経路で行われることを前提とする。

---

### 2.4 IP アドレスに関する設計上の制約

本プロジェクトでは、以下を制約条件として採用する。

- IPアドレス帯を固定しない
- IPアドレス自体を仕様の一部として扱わない
- 疎通条件は「同一セグメントであること」のみを前提とする

Verify において確認すべきなのは、

> **「どのIPか」ではなく、「設計上想定された経路で疎通しているか」**

である。

---

### 2.5 前提条件が満たされない場合の扱い

- 前提条件が満たされていない場合、Verify はその事実を明示する
- Verify は前提条件を「自動修復」しない
- 前提条件を満たすための操作は、利用者の判断に委ねる

これにより、

- Verify の責務を明確化する
- 「なぜ失敗しているか」を説明可能にする
- 不可解なエラーや暗黙の前提を排除する

---

## 第2章で確定した判断

- ネットワークの不定性を前提として受け入れる
- 管理通信は外部ネットワークから分離する
- IP アドレスに意味を持たせない
- Verify は「前提を喋る」存在とする

---

## 3. ディレクトリ・ファイル構成仕様

本章では、本プロジェクトにおける
**リポジトリ内ディレクトリ構成の考え方と位置づけ**を定義する。

ここで定義する内容は、

- スクリプトの配置場所を固定するため
- 利用者が「どこを触ればよいか」を迷わないため
- Verify が前提条件として説明できる構造を保つため

のものである。

---

### 3.1 リポジトリ構成（概要）

本プロジェクトでは、以下のディレクトリ構成を基本とする。

- `scripts/`
- `src/`
- `Source/`
- `docs/`

これらは、Build / Verify / Test の流れを
**ディレクトリ単位で分離して理解できる**ことを目的としている。

---

### 3.2 各ディレクトリの位置づけ

| ディレクトリ | 位置づけ |
| ---------- | --------------------------- |
| `scripts/` | 利用者がホスト上で直接実行するスクリプト群 |
| `src/` | 仮想マシン内部で使用される設定ファイル・補助スクリプト |
| `Source/` | ISO 等の外部から取得する資材置き場 |
| `docs/` | 設計方針・前提条件・判断経緯を残す文書群 |

---

### 3.3 `scripts/` ディレクトリ

`scripts/` には、利用者が **ホストOS上で直接実行するスクリプト**のみを配置する。

- Build-TestEnvironment.ps1
- Verify-TestEnvironment.ps1

などがこれに該当する。

このディレクトリに置かれるスクリプトは、

- 実行順序が明確であること
- 利用者が「入口」として迷わず実行できること

を前提とする。

---

### 3.4 `src/` ディレクトリ

`src/` は、仮想マシン内部で使用されるファイル群を配置するためのディレクトリである。

主に以下を含む。

- 無人応答ファイル（unattend.xml）
- MockServer 初期構成用スクリプト
- 仮想マシン内でのみ意味を持つ設定ファイル

`scripts/` と異なり、
利用者が直接実行することは想定しない。

---

### 3.5 `Source/` ディレクトリ

`Source/` は、外部から取得する資材を格納するためのディレクトリである。

例：

- Windows Server / Client の ISO イメージ
- 仮想マシン展開に使用するバイナリ資材

このディレクトリの中身は、

- サイズが大きい
- ライセンスや取得方法が環境依存である

といった特性を持つため、
**Git 管理対象外とすることを前提**とする。

---

### 3.6 `docs/` ディレクトリ

`docs/` には、本プロジェクトに関する以下の情報を集約する。

- 設計方針
- 前提条件
- 判断理由
- 仕様変更の履歴

コードを読まなくても
**「なぜこの構成になっているのか」を追えること**を目的とする。

---

### 3.7 ディレクトリ追加・変更時の扱い

本プロジェクトでは、将来的にディレクトリが追加される可能性を否定しない。

ただし、以下を原則とする。

- 新しいディレクトリを追加する場合
  → 本章（ディレクトリ構成仕様）を更新する
- 一時的・試験的なファイル置き場は
  → 既存ディレクトリ配下に限定する

これにより、

- ディレクトリ増殖による構造崩壊を防ぐ
- Verify が前提条件を説明できる状態を維持する

---

## 第3章で確定した判断

- ディレクトリ構成は「Build / Verify / Test の理解」を助けるためのもの
- 各ディレクトリは用途・位置づけで区別する
- ディレクトリ追加時は仕様書側を正として更新する

---

## 4. ネットワーク設計

本プロジェクトにおけるネットワーク設計は、
**外部ネットワークの不確実性を前提としつつ、検証環境を安定して再現できること**を目的とする。

そのため、仮想マシンの役割と通信目的に応じて、
仮想スイッチを明確に分離する設計を採用する。

---

### 4.1 仮想スイッチ構成（確定）

| vSwitch名 | 種別 | 目的 | ホスト接続 |
| ---------------- | -------- | -------- | ----- |
| vSwitch-Internet | External | 外部通信 | あり |
| vSwitch-LGWAN | Private | LGWAN 模擬 | なし |
| vSwitch-HostMgmt | Internal | 管理・検証 | あり |

各 vSwitch は **役割が重ならない**ことを前提に設計されており、
一つの通信目的を複数の vSwitch に担わせない。

---

### 4.2 vSwitch-Internet 設計方針

**vSwitch-Internet** は、仮想マシンが外部ネットワークへ接続するためのスイッチである。

- 種別: External
- 主な用途:

  - Windows Update
  - パッケージ取得
  - 外部リソースへの一時的アクセス

#### 設計上の考え方

- 接続される外部ネットワーク（社内LAN / Wi-Fi / テザリング等）は **不定**
- ホストのIPアドレス・セグメントは実行環境ごとに変化する
- そのため、本スイッチ上のIPアドレスに **設計上の意味を持たせない**

vSwitch-Internet は
**「あれば便利だが、存在しなくても Build / Verify の本質は成立する」**
という位置づけとする。

---

### 4.3 vSwitch-LGWAN 設計方針

**vSwitch-LGWAN** は、LGWAN 環境を模擬するための閉域ネットワークである。

- 種別: Private
- 主な用途:

  - LGWAN 側ネットワークの存在を前提とした検証
  - 外部ネットワークと完全に分離された通信経路の再現

#### vSwitch-LGWAN 設計上の考え方

- ホストOSからは **一切アクセスできない**
- 外部ネットワークとも接続しない
- 純粋に仮想マシン間の閉域ネットワークとして扱う

本スイッチは
**「疎通できないこと」そのものが設計意図**であり、
Verify においても疎通確認の対象とはしない。

---

### 4.4 vSwitch-HostMgmt 設計方針（確定）

**vSwitch-HostMgmt** は、本プロジェクトにおける管理・検証の要となるスイッチである。

- 種別: Internal
- 主な用途:

  - WinRM による管理通信
  - Verify-TestEnvironment の実行基盤
  - ホスト ⇔ MockServer 間の疎通確認

#### vSwitch-HostMgmt 設計上の考え方

- 外部ネットワークから **完全に独立**した管理経路を提供する
- IPアドレス帯は固定しない
- DHCP / 手動設定いずれでもよいが、以下を満たすことを前提とする

> **ホストと MockServer が同一セグメントで相互疎通可能であること**

これにより、

- 外部ネットワーク環境に左右されない
- TrustedHosts / WinRM の前提条件を明示できる
- Verify が「環境の前提」を説明できる

という効果を得る。

---

### 4.5 設計上の重要な原則

本ネットワーク設計は、以下の原則に基づく。

- 管理通信は vSwitch-HostMgmt に集約する
- 外部通信は vSwitch-Internet に閉じ込める
- 模擬閉域網は vSwitch-LGWAN に隔離する
- **IP アドレスに意味を持たせない**
- **疎通経路をコードとドキュメントで明示する**

これにより、
Build / Verify / 運用時の混乱を最小化することを目指す。

---

## 5. 仮想マシン設計

本章では、本検証環境で使用する仮想マシンの構成と役割を定義する。

ここで定義する仮想マシンは、

- 実機PCの完全な代替
- 本番環境の忠実な再現

を目的とするものではない。

**キッティング手順・自動化スクリプトの検証が行える最小構成**として設計する。

---

### 5.1 MockServer

MockServer は、キッティング検証環境の中核となる仮想マシンである。

#### MockServer の基本構成

- 世代: Generation 2
- OS: Windows Server 2019 Evaluation
- セキュアブート / 仮想TPM: 有効

#### 接続ネットワーク

| 接続先 | vSwitch |
| -------- | ---------------- |
| 管理・検証 | vSwitch-HostMgmt |
| 外部通信 | vSwitch-Internet |
| LGWAN 模擬 | vSwitch-LGWAN |

#### 主な役割

- Active Directory ドメインコントローラー
- 共有フォルダ提供
- キッティング用ファイル配布基盤

MockServer は、
**キッティング対象端末が接続する「管理・配布側」の代表**として振る舞う。

---

### 5.2 Test-PC

Test-PC は、実機PCの代替として
**キッティング対象端末の挙動を検証するための仮想マシン**である。

#### Test-PC の基本構成

- 世代: Generation 2
- 仮想TPM: 有効
- セキュアブート: 有効

#### OS 方針（確定）

- OS: Windows 11
- **自動展開を前提とする**

本番で導入されるPCは、
多くの場合「Windows がインストール済みの状態」で納品される。

そのため、本検証環境でも、

- OS がすでに存在する状態
- OOBE 以降のフェーズ

を起点とした検証を行える構成とする。

---

### 5.3 Test-PC における OS 展開の考え方

Test-PC の OS は、以下の理由から **手動インストールを前提としない**。

- 検証の再現性を高めるため
- Build → Verify の流れに組み込むため
- 人手作業を最小化するため

ただし、本プロジェクトでは、

- OEM メーカーごとの差異
- プリインストールツールの違い

までを再現することは目的としない。

---

### 5.4 Office（LTSC）に関する扱い

Office（特に LTSC）については、以下の設計判断を採用する。

- Test-PC には **Office をプリインストールしない**
- Office は **キッティング工程の一部として後から導入する前提**とする

理由は以下の通り。

- LTSC は OEM プリインストールが一般的ではない
- ライセンス形態・導入方法が組織ごとに異なる
- OS 展開と Office 展開は工程として分離した方が検証しやすい

そのため、本検証環境では、

- OS 展開
- ドメイン参加
- アプリケーション配布

を **段階的に検証可能な構成**とする。

---

### 5.5 本章で確定した設計判断

- Test-PC の OS は自動展開前提とする
- 実機納品形態（Windows インストール済み）を意識するが、厳密再現はしない
- Office（LTSC）は後工程で導入する設計とする
- 仮想マシンは「検証のための最小構成」を重視する

---

## 6. Build-TestEnvironment.ps1 の役割と境界

本章では、`Build-TestEnvironment.ps1` が
**何を実行対象とし、どこまでを保証するスクリプトなのか**を明確にする。

本スクリプトは、
検証環境を「使い始められる状態」にすることを目的とし、
その後の設定・検証・判断までを内包しない。

---

### 6.1 Build-TestEnvironment.ps1 が行うこと

`Build-TestEnvironment.ps1` は、以下の処理を担当する。

- 仮想スイッチの存在確認および作成
- 仮想マシン（MockServer / Test-PC）の作成
- 仮想ディスク（VHD）の初期化
- OS イメージの展開
- 初期起動に必要なファイルの配置

これらはすべて、

- **再実行可能**
- **途中で止まっても再実行で復旧可能**

であることを前提として設計される。

---

### 6.2 Build-TestEnvironment.ps1 が扱わないこと

本スクリプトは、以下の内容を対象外とする。

- Active Directory の詳細構成
- 仮想マシン内部のネットワーク設定
- 検証結果の合否判断

これらは、

- `Setup-MockServer.ps1`
- `Verify-TestEnvironment.ps1`

など、別の工程・別のスクリプトで扱う。

---

### 6.3 設計上の意図

`Build-TestEnvironment.ps1` は、

- **環境を「作る」**
- **正しく作れたかは判断しない**

という立ち位置を取る。

この分離により、

- Build → Verify → Test の工程を明確に分ける
- 問題発生時に「どの工程の問題か」を切り分けやすくする
- 検証観点を後から拡張しやすくする

ことを狙っている。

---

## 7. Setup-MockServer.ps1 との役割分担

本章では、
`Build-TestEnvironment.ps1` と `Setup-MockServer.ps1` の間で
**どこまでを Build が行い、どこからを Setup が担うのか**を明確にする。

---

### 7.1 各スクリプトの位置づけ

本プロジェクトにおける各スクリプトの役割は以下のとおりとする。

- **Build-TestEnvironment.ps1**
  → 検証環境を「作る」

- **Setup-MockServer.ps1**
  → MockServer 内部を「整える」

Build はあくまで **器を用意する工程**であり、
Setup はその器の中を **利用可能な状態に初期化する工程**である。

---

### 7.2 Setup-MockServer.ps1 が担う内容

`Setup-MockServer.ps1` は、MockServer 内部で実行され、以下を担当する。

- ネットワークアダプターの内部設定
- Active Directory の構築
- 共有フォルダの作成
- キッティングに必要な基盤設定

これらはすべて **仮想マシン内部の責務**であり、
ホスト側からはブラックボックスとして扱う。

---

### 7.3 設定値の扱い

`Setup-MockServer.ps1` が使用する設定値は、
すべて `config.ps1` に委譲する。

これにより、

- スクリプト本体と環境依存値を分離する
- 設定変更時にスクリプト改修を不要とする
- 検証環境差分を明示的に管理できる

という設計を取る。

---

### 7.4 Verify との関係（ALL GREEN への接続点）

`Setup-MockServer.ps1` の完了は、
**Verify-TestEnvironment.ps1 による検証対象**となる。

- Setup は「正しく整えたつもり」で終わる
- Verify が「前提を満たしているか」を確認する
- ALL GREEN は Verify によってのみ宣言される

この分離により、

- 構築（Build）
- 初期設定（Setup）
- 確認（Verify）

の各工程が混ざらない設計とする。

---

## 8. Verify-TestEnvironment.ps1 の設計思想と ALL GREEN

### 8.1 Verify の位置づけ

`Verify-TestEnvironment.ps1` は、
Build / Setup によって構築された検証環境に対し、
**設計上の前提が満たされているかを確認するためのスクリプト**である。

Verify の目的は、単なる成否判定ではない。

- 前提条件を明示的に言語化する
- 設計からの逸脱を検出する
- 問題発生時に「なぜ失敗しているのか」を利用者に伝える

Verify は **Build の成功を保証するものではない**。
また、Verify が失敗した場合でも、それは必ずしも不具合を意味しない。

---

### 8.2 ALL GREEN の考え方

本プロジェクトにおける **ALL GREEN** とは、

> 「本仕様書で定義した前提条件が、
> 現在の実行環境において満たされている状態」

を指す。

ALL GREEN は以下を意味しない。

- すべての機能が完全に動作すること
- 本番環境と同等の安全性が確保されていること
- ネットワークやOS構成に問題が一切存在しないこと

ALL GREEN はあくまで、
**次の工程（Test / 検証作業）に進んでよい状態かどうかの判断材料**である。

---

### 8.3 判定対象（Verify が確認するもの）

Verify は、以下の観点を判定対象とする。

- 仮想スイッチ構成が設計どおり存在していること
- 仮想マシンが存在し、想定された世代・設定であること
- 管理経路（WinRM 等）が成立する前提条件が満たされていること
- MockServer が **管理通信可能な状態にあること**

特に重要なのは、
**IPアドレスそのものではなく「疎通可能であるか」**を確認する点である。

Verify は、IPアドレスの固定値や特定ネットワークへの依存を前提としない。

---

### 8.4 非判定対象（Verify が確認しないもの）

Verify は、以下の内容を判定対象としない。

- Active Directory の詳細構成内容
- ファイル共有の中身や運用ルール
- セキュリティポリシーの妥当性
- 外部ネットワーク（Wi-Fi / テザリング等）の健全性

これらは **Test フェーズ、または別途検証工程で扱うべき内容**であり、
Verify に含めないことで、判定の意味を明確にする。

---

### 8.5 前提条件の可視化という役割

Verify の最も重要な役割は、
**暗黙の前提を利用者に「喋らせる」こと**である。

そのため Verify は、

- 前提条件を明示的に出力する
- 前提が崩れている場合、その理由を説明する
- 「どこまで進めてよいか」を利用者が判断できる情報を提供する

ことを重視する。

ALL GREEN はゴールではなく、
**判断を支援するための状態表示**である。

---

## 9. 設計判断ログ（抜粋）

本章は、本仕様書および関連スクリプトにおける  
主要な設計判断と、その背景を記録する。

ここに記載される内容は、  
「最適解」や「正解」を主張するものではなく、  
**なぜこの形を選択したのか**を後から追跡可能にするためのものである。

### 9.1 IP 固定前提の破棄

当初、管理通信は固定IPを前提として設計されていた。

しかし以下の理由により、この前提は破綻すると判断した。

- 外部ネットワーク（Wi-Fi / テザリング / 社内LAN）が不定
- ホストのIPアドレスは実行環境ごとに変動する
- IP 固定は環境依存性を高め、再現性を損なう

その結果、  
**IPアドレスそのものに意味を持たせない設計**へ方針転換した。

---

### 9.2 vSwitch-Internet 依存の管理通信を採用しない判断

vSwitch-Internet 経由での管理通信は、

- 外部ネットワークの状態
- ホスト側のIP割当
- ファイアウォール挙動

に強く依存する。

これにより Verify が「失敗している理由」を  
環境外要因と切り分けにくくなるため、採用しない判断とした。

---

### 9.3 vSwitch-HostMgmt 導入の判断

管理・検証用の通信経路を外部ネットワークから分離するため、  
vSwitch-HostMgmt（Internal）を導入した。

これにより、

- ホストと MockServer の管理経路を明示できる
- Verify の前提条件を構造として表現できる
- 外部ネットワーク非依存の検証が可能になる

という効果を得ている。

---

### 9.4 Verify を「前提を喋るスクリプト」と位置づけた理由

Verify は合否判定ツールではなく、  
**前提条件の可視化と設計逸脱の検出**を目的とする。

そのため、

- 失敗時は「なぜ失敗しているか」を出力する
- 環境依存要因を積極的に説明する
- ALL GREEN を特別な状態として扱わない

という設計方針を採用している。

---

## 10. 今後の拡張余地

本章では、本仕様書 v0.1 時点では **あえて確定させていない事項**、および
将来的に検討・拡張が想定される領域について整理する。

ここに記載する内容は、

- 現時点では「未決」
- ただし、**設計上の延長線として想定されている**

という位置づけとする。

---

### 10.1 Verify の exit code 設計

現状の `Verify-TestEnvironment.ps1` は、

- 状態や前提条件を **可視化する**
- 失敗理由を **説明する**

ことを主目的としており、
exit code による厳密な機械判定は行っていない。

今後の拡張として、以下の方向性が考えられる。

- exit code を段階的に定義する
  （例: 前提未満 / Build 未完了 / 検証可能 / Test 可能 など）
- CI 等からの自動実行を想定した最小限の機械判定を追加する
- ただし、人間の判断を完全に置き換えることは目的としない

重要なのは、exit code を導入したとしても、

> Verify は「合否を断定する存在」ではなく
> **判断材料を提供する存在である**

という設計思想を崩さないことである。

---

### 10.2 Test-PC 構築・初期化の完全自動化

現時点では、Test-PC は

- OS 展開後
- OOBE 以降の状態

を前提とした検証対象としている。

今後の拡張としては、以下が検討対象となる。

- Test-PC の OS 展開から完全自動化する
- ドメイン参加までを Build / Setup フェーズに含める
- キッティング対象としての初期状態をテンプレート化する

ただし、ここでも以下の点に注意する。

- OEM 差異やメーカー固有要素の完全再現は目的としない
- 「自動化できること」よりも「再現性があること」を優先する

Test-PC の自動化は、
**検証効率を上げるための手段**であり、ゴールではない。

---

### 10.3 Snapshot / Checkpoint 戦略

検証環境を繰り返し利用する上で、

- 状態を戻せること
- 失敗前の状態に復帰できること

は重要な要素となる。

将来的には、以下のような運用を検討できる。

- Build 完了時点でのチェックポイント作成
- Setup-MockServer 完了時点でのチェックポイント作成
- Test フェーズ前後での明示的なスナップショット管理

ただし、スナップショットはあくまで **補助的手段**であり、

- 設計や Verify の代替
- 不整合を隠すための逃げ道

として使うことは避ける。

---

### 10.4 本章の位置づけ

本章に記載した内容は、

- 今すぐ実装すべきものではない
- しかし、将来「なぜそうなったのか」を説明するために残す

ためのものである。

設計が進化した結果、

- 本章の一部が確定仕様になる
- 別章として独立する

ことも想定される。

その場合は、

- 本仕様書を正本として更新する
- 実装はその後に追従させる

という原則を維持する。

---

### 第10章で整理した考え方

- ALL GREEN は通過点であり、目的ではない
- 拡張は「自動化」より「説明可能性」を優先する
- 将来の選択肢を閉じないために、今は決めない判断もある

---
